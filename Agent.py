import numpy as np

class stupidAgent():
    def __init__(self, stepLimit:int, number_of_bandits:int, epsilon:float, UCB_constant:float) -> None:
        self.stepLimit = stepLimit
        self.curr_step = 0.0
        self.num_of_bandit = number_of_bandits     
        self.epsilon = epsilon
        self.E_ratio = [0, 0]       
        self.UCB_constant = UCB_constant  
        self.reward = np.zeros(number_of_bandits)  
        self.reward_history = np.array([self.reward])   
        self.actionVaule = np.zeros(number_of_bandits)
        self.actionVaule_history = np.array([self.actionVaule])
        self.actionCount = np.zeros(number_of_bandits)
        self.bestAction = np.random.randint(number_of_bandits, size=1)  #initial action
        
    
    def update(self, action:int, reward:float)->None:
        self.curr_step += 1.0
        self.reward[action] += reward
        self.actionCount[action] += 1.0
        self.actionVaule[action] = self.actionVaule[action] + (reward - self.actionVaule[action])/self.actionCount[action]
        self.update_history()
    
    def update_history(self)->None:
        self.reward_history = np.concatenate((self.reward_history,np.array([self.reward])), axis=0)
        self.actionVaule_history = np.concatenate((self.actionVaule_history,np.array([self.actionVaule])), axis=0)
    
    def epsilon_greedy(self, epsilon:float)->int:
        decision = np.random.rand()
        if decision <= epsilon:
            self.E_ratio[0] += 1
            selected_action = np.random.randint(self.num_of_bandit, size=1)
        else:
            self.E_ratio[1] += 1
            max_vaule = max(self.actionVaule)
            max_ind = []
            for i in range(self.num_of_bandit):
                if self.actionVaule[i] == max_vaule:
                    max_ind.append(i)
            selected_action = np.random.choice(max_ind)
            self.bestAction = selected_action
        return selected_action
    
    def action_selection(self, method:str)->int:
        match method:
            case "greedy":
                selected_action = self.epsilon_greedy(self.epsilon)
            case "UCB":
                pass
        return selected_action
    
    def debug(self)->None:
        print("Explolation-Exploitation counts :", self.E_ratio)
        print("Final step action value : ", self.actionVaule)
        print("Final step action counts : ", self.actionCount)
        print("Best action, Bandit number(start with 0) : ", self.bestAction)
        
        
            
           
        